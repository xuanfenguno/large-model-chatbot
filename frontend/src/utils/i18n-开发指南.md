# 国际化语言包开发指南

## 概述

此文档为外包开发人员提供的国际化(i18n)语言包系统开发指南。当前系统已预留完整的语言包接口框架，需要实现完整的多语言支持功能。

## 当前状态

### 已完成
- ✅ 语言包接口框架 (`src/utils/i18n.js`)
- ✅ 语言设置保存功能
- ✅ 语言选择界面
- ✅ 基础CSS语言类支持

### 待实现
- ❌ 语言包文件加载系统
- ❌ 动态文本翻译功能
- ❌ 界面语言实时切换
- ❌ 语言包热更新

## 核心接口说明

### 语言包管理工具 (`i18n.js`)

```javascript
// 初始化语言包系统
import { initI18n, switchLanguage, t } from '@/utils/i18n'

// 初始化
await initI18n('zh')

// 切换语言
await switchLanguage('en')

// 获取翻译
t('settings.title') // 返回翻译后的文本
```

### 主要函数

| 函数名 | 功能 | 参数 | 返回值 |
|--------|------|------|--------|
| `initI18n(lang)` | 初始化语言包 | 语言代码 | Promise<boolean> |
| `switchLanguage(lang)` | 切换语言 | 语言代码 | Promise<boolean> |
| `t(key, params)` | 获取翻译 | 键名, 参数 | 翻译文本 |
| `getCurrentLanguage()` | 获取当前语言 | - | 语言代码 |
| `getSupportedLanguages()` | 获取支持的语言 | - | 语言列表 |

## 开发需求

### 1. 语言包文件结构

```
public/locales/
├── zh.json      # 中文语言包
├── en.json      # 英文语言包
├── ja.json      # 日文语言包
└── ko.json      # 韩文语言包
```

**语言包文件示例 (`zh.json`):**
```json
{
  "common": {
    "save": "保存",
    "cancel": "取消",
    "confirm": "确认"
  },
  "settings": {
    "title": "设置",
    "language": "语言",
    "theme": "主题"
  },
  "chat": {
    "send": "发送",
    "newMessage": "新消息"
  }
}
```

### 2. 翻译键命名规范

使用分层结构命名：
- `common.xxx` - 通用文本
- `settings.xxx` - 设置界面
- `chat.xxx` - 聊天界面
- `voice.xxx` - 语音功能
- `video.xxx` - 视频功能

### 3. 动态参数支持

支持带参数的翻译：
```javascript
// 语言包定义
{
  "chat": {
    "messageCount": "您有{count}条新消息"
  }
}

// 使用
t('chat.messageCount', { count: 5 }) // "您有5条新消息"
```

### 4. 组件集成方案

#### Vue组件中使用：
```vue
<template>
  <div>
    <h1>{{ $t('settings.title') }}</h1>
    <button @click="switchLang('en')">{{ $t('common.switchLanguage') }}</button>
  </div>
</template>

<script>
import { useI18n } from '@/utils/i18n'

export default {
  setup() {
    const { t, switchLanguage } = useI18n()
    
    const switchLang = async (lang) => {
      await switchLanguage(lang)
    }
    
    return { t, switchLang }
  }
}
</script>
```

### 5. 语言切换流程

1. **用户选择语言** → 设置界面选择新语言
2. **保存设置** → 调用 `switchLanguage(newLang)`
3. **加载语言包** → 从服务器/本地加载对应语言包
4. **更新界面** → 重新渲染所有文本内容
5. **持久化存储** → 保存语言设置到本地存储

## 技术实现要点

### 1. 语言包加载策略
- **按需加载**: 只在需要时加载语言包
- **缓存机制**: 缓存已加载的语言包
- **回退机制**: 如果目标语言包加载失败，使用默认语言

### 2. 界面更新机制
- **响应式更新**: 使用Vue的响应式系统
- **组件级更新**: 组件自动响应语言变化
- **性能优化**: 避免不必要的重新渲染

### 3. 错误处理
- **网络错误**: 语言包加载失败时的处理
- **格式错误**: JSON格式验证
- **键缺失**: 翻译键不存在时的回退策略

## 测试要求

### 功能测试
- [ ] 语言切换功能正常
- [ ] 所有界面文本正确翻译
- [ ] 参数替换功能正常
- [ ] 语言包加载错误处理

### 性能测试
- [ ] 语言包加载时间 < 500ms
- [ ] 语言切换响应时间 < 200ms
- [ ] 内存占用合理

### 兼容性测试
- [ ] 支持所有配置的语言
- [ ] 浏览器兼容性（Chrome, Firefox, Safari, Edge）
- [ ] 移动端兼容性

## 部署说明

### 开发环境
- 语言包文件放在 `public/locales/` 目录
- 支持热重载开发

### 生产环境
- 语言包文件打包到静态资源
- 支持CDN加速加载
- 配置缓存策略

## 后续扩展

### 计划功能
- 语言包在线编辑
- 实时翻译预览
- 语言包版本管理
- 自动翻译API集成

## 联系信息

如有技术问题，请联系项目负责人。

---
*文档版本: 1.0*  
*最后更新: 2026-01-20*