# 基于大模型的聊天机器人应用 - 使用指南

## 项目概述

这是一个功能完整的AI聊天机器人应用，集成了前端Vue 3和后端Django REST Framework，支持多模型聊天、历史记录管理和用户身份认证。

## 项目特性

### 核心功能
- ✅ **智能对话**：支持与多种大模型进行自然语言对话
- ✅ **多模型支持**：集成OpenAI GPT系列、Anthropic Claude系列、DeepSeek、通义千问等多种大模型
- ✅ **模型切换**：支持在聊天过程中动态切换不同的AI模型
- ✅ **历史记录**：自动保存聊天历史，支持恢复和管理对话
- ✅ **身份认证**：完整的用户注册、登录和个人信息管理
- ✅ **消息管理**：支持发送文本、图片等多种消息类型
- ✅ **实时响应**：流式输出，提供沉浸式聊天体验

### 技术特性
- ✅ **响应式设计**：适配PC、平板、手机等多种设备
- ✅ **性能优化**：使用Vue 3 Composition API和高效的状态管理
- ✅ **API文档**：自动生成Swagger API文档
- ✅ **数据库管理**：SQLite/MySQL数据库支持，数据持久化

## 快速启动

### 1. 环境准备

确保你的系统已安装以下软件：
- Python 3.9+
- Node.js 16+
- npm 7+

### 2. 安装依赖

```bash
# 克隆项目（如果尚未克隆）
git clone <repository-url>
cd AI-Chatbot

# 安装后端依赖
cd backend
pip install -r requirements.txt

# 安装前端依赖
cd ../frontend
npm install
```

### 3. 环境变量配置

1. 复制 `.env` 文件并配置API密钥：
```bash
# 项目根目录下
cp .env .env  # 实际上.env文件已存在，这里是确认它存在
```

2. 编辑 `.env` 文件，配置大模型API密钥：
```env
# 数据库配置
DB_NAME=chatbot_db
DB_USER=root
DB_PASSWORD=root123
DB_HOST=localhost
DB_PORT=3306

# Django配置
DJANGO_SECRET_KEY=django-insecure-key-change-in-production
DEBUG=True

# 大模型API密钥配置（根据需要配置）
OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
ANTHROPIC_API_KEY=sk-ant-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
DEEPSEEK_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
QWEN_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

### 4. 数据库初始化

```bash
cd backend

# 迁移数据库
python manage.py makemigrations
python manage.py migrate

# 创建超级用户（用于访问管理员页面）
python manage.py createsuperuser
```

### 5. 启动服务

#### 自动启动（推荐）

使用项目根目录的启动脚本：

```bash
# 启动应用程序
chmod +x start_server.sh
./start_server.sh
```

#### 手动启动

**启动后端服务器：**

```bash
cd backend
python manage.py runserver 0.0.0.0:8000
```

**启动前端服务器：**

```bash
cd frontend
npm run dev
```

### 6. 访问应用

- **前端应用**：http://localhost:3000
- **后端API**：http://localhost:8000/api/v1/
- **API文档**：http://localhost:8000/swagger/

## 功能使用说明

### 用户认证

#### 注册新用户

1. 访问应用首页
2. 点击"注册"按钮
3. 填写用户名、邮箱、密码等信息
4. 点击"注册"按钮完成注册

#### 登录系统

1. 访问应用首页
2. 点击"登录"按钮
3. 输入用户名和密码
4. 点击"登录"按钮

### 聊天功能

#### 开始新对话

1. 登录后进入聊天页面
2. 在输入框中输入消息
3. 点击发送按钮或按Enter键
4. AI会立即响应

#### 切换聊天模型

1. 在聊天页面顶部点击模型选择下拉框
2. 选择想要使用的大模型（如GPT-4o Mini, Claude 3 Haiku, DeepSeek V3等）
3. 新的对话将使用所选模型

#### 发送图片消息

1. 在消息输入框中直接粘贴图片或拖拽图片到输入框
2. 点击发送按钮
3. AI会分析图片内容并回复

#### 管理聊天历史

1. 在左侧侧边栏可以看到所有聊天历史
2. 点击历史记录可以恢复对话
3. 点击删除按钮可以删除不需要的对话

### 模型选择

#### 查看支持的模型

1. 在聊天页面顶部可以看到模型选择下拉框
2. 下拉框中列出了所有支持的大模型
3. 每个模型旁边显示了提供商信息

#### 更换模型

1. 在模型选择下拉框中选择新的模型
2. 新发送的消息将使用新选择的模型进行处理
3. 您可以在同一个对话中使用不同模型

## API接口文档

### 用户认证接口

#### 注册用户

**接口地址：** `/api/v1/register/`

**请求方法：** POST

**请求参数：**
```json
{
  "username": "用户名",
  "email": "邮箱地址",
  "password": "密码"
}
```

#### 用户登录

**接口地址：** `/api/v1/login/`

**请求方法：** POST

**请求参数：**
```json
{
  "username": "用户名",
  "password": "密码"
}
```

### 聊天接口

#### 发送消息

**接口地址：** `/api/v1/messages/chat/`

**请求方法：** POST

**请求参数：**
```json
{
  "conversation_id": 1,
  "message": "用户消息内容",
  "image_url": "图片URL（可选）",
  "model": "gpt-4o-mini"  // 可选模型
}
```

#### 获取可用模型

**接口地址：** `/api/v1/models/`

**请求方法：** GET

**响应格式：**
```json
[
  {
    "id": "gpt-4o-mini",
    "name": "GPT-4o Mini",
    "provider": "OpenAI"
  },
  {
    "id": "claude-3-haiku",
    "name": "Claude 3 Haiku",
    "provider": "Anthropic"
  },
  {
    "id": "deepseek-v3",
    "name": "DeepSeek V3",
    "provider": "DeepSeek"
  }
]
```

#### 创建对话

**接口地址：** `/api/v1/conversations/`

**请求方法：** POST

**请求参数：**
```json
{
  "title": "对话标题",
  "model": "gpt-4o-mini"  // 可选模型
}
```

#### 获取历史对话

**接口地址：** `/api/v1/conversations/`

**请求方法：** GET

## 支持的大模型

本项目集成了多种主流大模型：

### OpenAI系列
- GPT-4o, GPT-4o Mini, GPT-4 Turbo
- GPT-3.5 Turbo

### Anthropic系列
- Claude 3 Opus, Claude 3 Sonnet, Claude 3 Haiku

### DeepSeek
- DeepSeek V3, DeepSeek R1

### 阿里巴巴通义千问
- Qwen Max, Qwen Plus, Qwen Turbo, Qwen VL系列

## 开发与调试

### 查看服务器状态

**检查后端服务器**：

```bash
ps aux | grep python
curl -X GET http://localhost:8000/api/v1/health/
```

**检查前端服务器**：

```bash
ps aux | grep vite
curl -I http://localhost:3000
```

### 重启服务器

**使用重启脚本：**

```bash
chmod +x restart_app.sh
./restart_app.sh
```

**手动重启：**

```bash
# 停止服务器
pkill -f 'python manage.py runserver'
pkill -f 'vite'

# 重新启动
./start_server.sh
```

## 常见问题与解决方案

### 1. 数据库连接失败

**问题现象**：后端服务器启动时提示数据库连接失败

**解决方案**：
- 检查数据库配置是否正确
- 确保数据库服务正在运行
- 尝试重新创建数据库
- 检查数据库用户权限

### 2. 前端无法连接到后端

**问题现象**：前端页面无法加载数据，显示网络错误

**解决方案**：
- 检查后端服务器是否正在运行
- 确认API地址和端口是否正确
- 检查防火墙设置
- 尝试使用不同的网络连接

### 3. 模型API调用失败

**问题现象**：发送消息后AI无响应或报错

**解决方案**：
- 检查API密钥是否正确配置
- 确认网络连接是否正常
- 检查API服务是否可用
- 查看服务器日志定位问题

### 4. 模型选择功能无效

**问题现象**：在界面上选择模型后，对话仍然使用默认模型

**解决方案**：
- 确认后端是否正确接收了模型参数
- 检查API密钥是否支持所选模型
- 查看服务器日志确认模型切换是否生效

### 5. 页面加载慢或显示异常

**问题现象**：页面加载缓慢或显示不正确

**解决方案**：
- 清除浏览器缓存
- 检查网络连接速度
- 确保服务器资源充足
- 查看浏览器控制台的错误信息

## 部署到生产环境

### 前端部署

```bash
cd frontend
npm run build
```

将生成的 `dist` 目录部署到Web服务器（如Nginx、Apache等）。

### 后端部署

```bash
cd backend

# 使用Gunicorn部署
pip install gunicorn
gunicorn config.wsgi:application --bind 0.0.0.0:8000 --workers 4

# 或使用uWSGI
pip install uwsgi
uwsgi --http :8000 --module config.wsgi
```

### 生产环境配置

**修改配置文件**：

```python
# backend/config/settings.py
DEBUG = False

ALLOWED_HOSTS = ['your-domain.com', 'localhost']

# 数据库配置
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        'NAME': 'chatbot_db',
        'USER': 'your_username',
        'PASSWORD': 'your_password',
        'HOST': 'localhost',
        'PORT': '3306',
    }
}
```

## 技术支持

如果您在使用过程中遇到问题，请：

1. 检查服务器日志文件
2. 查看浏览器控制台错误信息
3. 尝试重启服务器
4. 检查网络连接和API密钥配置
5. 确认所选模型的API密钥是否有效

## 许可证

本项目采用MIT许可证，可自由使用、修改和分发。

---

**注意**：首次使用时，请确保已完成数据库迁移和创建超级用户操作。如果遇到任何问题，请参考常见问题与解决方案部分。